Many applications, such as the construction of ZK-SNARKs, require a polynomial commitment scheme where an evaluation leaks no information about the committed polynomial beyond its value at the queried point. To provide this we show how to build a hiding polynomial commitment along with a zero-knowledge evaluation protocol.

We start by defining what it means for a polynomial commitment scheme to be \emph{hiding}:

\begin{definition}
A commitment scheme $\Gamma = (\pro{Setup}, \pro{Commit}, \pro{Open})$ is \defn{hiding} if for all probabilistic polynomial time adversaries $\adv = (\adv_0, \adv_1)$, the probability of distinguishing between commitments of different messages is negligible:
\[
	\left| 1 - 2 \cdot \mathrm{Pr}\left[
		\hat{b} = b \ \middle| \ 
		\begin{array}{l}
			\params \gets \pro{Setup}(1^\lambda) \\
			m_0, m_1, \st \gets \adv_0(\params) \\
			b \sample \{0,1\} \\
			(c; r) \gets \pro{Commit}(\params, m_b) \\
			\hat{b} \gets \adv_1(\st, c)
		\end{array}
	\right] \right| \leq \negl \enspace .
\]
\end{definition}
If the property holds for all algorithms then we say that the commitment is \emph{statistically} hiding.
\paragraph{Hiding Polynomial Commitment}
We make the polynomial commitment described in Section~\ref{sec:protocol} hiding by adding a degree $d+1$ term with a large random coefficient. Let $B\geq |\GG|$ be a publicly known upper bound on the order of $\GG$. We will choose the blinding coefficient between $0$ and $B\cdot 2^\lambda$. Formally, the hiding commitment algorithm is described as follows:
\begin{itemize}
	\item $\pro{CommitH}(f(X) \in \ZZ_p[X]) \rightarrow (\gr{C}; \hat{f}(X), d, r)$. Lift $f(X) \in \mathbb{Z}_p[X]$ to $\hat{f}(X) \in \mathbb{Z}(\frac{p-1}{2})[X]$ and select random integer $r \sample [0,B\cdot 2^\lambda)$. Compute $d \gets \deg(f(X))$ and $\gr{C} \gets (\hat{f}(q)+q^{d+1} \cdot r)\cdot \gr{g}$ and return commitment $\gr{C}$ with secret opening information $\hat{f}(X), d, r$.
\end{itemize}

Let $\gr{h} \leftarrow q^{d+1}\cdot \gr{g}$. 
To argue that $\gr{C}$ is hiding, it suffices to show that $\gr{C}$ is computationally indistinguishable from a random element of $\langle \gr{g}\rangle$, the cyclic group generated by $\gr{g}$. In a setting with trusted-setup, in which the trusted party has a trapdoor to compute the order of $\gr{g}$ (e.g. RSA groups), the trusted party can select $q$ such that $\gr{g}$ and $\gr{h}$ generate the same subgroup. In this case, $\gr{h}^r$ for $r \sample [0, B\cdot 2^\lambda)$ has statistical distance at most $2^{-\lambda}$ from uniform in $\langle \gr{g} \rangle$, so long as $B \geq |\langle \gr{g} \rangle|$. 

%The random coefficient $r$ ensures that $\gr{C}$ is nearly indistinguishable from a random group element. Assume that $\gr{g}$ and $\gr{g}^{q^{d+1}}$ generate the same group with order $n=|\langle \gr{g}\rangle|$. The element $\gr{A}\gets\gr{g}^c$ for $c\sample [0,n)$ is uniformly random from this subgroup. If $r \sample [0,B\cdot 2^\lambda)$ and $B\geq n$ then $\gr{B}\gets \gr{g}^r$ has statistical distance at most $2^{-\lambda}$ from uniform. Consequently $\gr{C}$ is statistically negligibly far from a random group element. 

Unfortunately, in a setting without a trusted setup, $\gr{h}$ might only generate a subgroup of $\langle \gr{g} \rangle$. The commitment then becomes computationally hiding under a \emph{Subgroup Indistinguishability Assumption}\footnote{Brakersi and Goldwasser define subgroup indistinguishability assumptions in a related but slightly different way.}~\cite{C:BraGol10}: our precise assumption is that no efficient adversary can distinguish a random element of $\langle \gr{h} \rangle$ from $\langle \gr{g} \rangle$ for any non-trivial $\gr{h} \in \langle \gr{g} \rangle$. %If an adversary can distinguish $\gr{C}$ from a random element with probability more than $2^{-\lambda}$ then he must be able to distinguish the subgroup generated by $\gr{g}^{q^{d+1}}$ from the subgroup generated by $\gr{g}$. 
For simplicity, Theorem~\ref{thm:hiding} assumes that $\gr{g}$ and $\gr{h}$ generate the same group. 

If the condition $\langle \gr{g} \rangle = {q^{d+1}} \cdot \langle \gr{g}\rangle$ cannot be guaranteed then the security proof must be modified to show that an adversary that can efficiently distinguish commitments with non-negligible probability must be able to distinguish between random elements sampled from $\langle \gr{g} \rangle$ and random elements sampled from $\langle q^{d+1}\cdot \gr{g} \rangle$. The informal proof sketch is as follows. 
Suppose there exists a non-uniform distinguisher $D_{f,g}$ that can distinguish freshly generated commitments to $f$ and $g$ with non-negligible probability, then the non-uniform adversary $\mathcal{A}_{f,g}$ may be constructed as follows: upon receipt of $\gr{g}'$ sampled either from $\langle \gr{g} \rangle$ or from $\langle  q^{d+1}\cdot \gr{g}\rangle$, it sends $f(q)\cdot \gr{g}+ \gr{g}'$ and $g(q)\cdot \gr{g}+ \gr{g}'$ to the distinguisher $D_{f,g}$. 
In the case that $\gr{g}'$ was sampled from $\langle  q^{d+1}\cdot \gr{g} \rangle$ this is a statistical simulation of a pair of commitments to $f$ and $g$ respectively, hence the distinguisher should succeed with non-negligible probability. In the case that $\gr{g}$ was sampled from $\langle \gr{g} \rangle$, the pair is actually statistically indistinguishable, and thus the distinguisher must fail. Thus, $\mathcal{A}_{f,g}$ is able to distinguish from which group $\gr{g}'$ was sampled with non-negligible probability, contradicting the subgroup indistinguishability assumption. 

\begin{theorem}\label{thm:hiding}
The commitment scheme $\Gamma = (\pro{Setup}, \pro{CommitH}, \pro{Open})$ is statistically hiding if $B \gg |\mathbb{G}|$ and if $\langle \gr{g} \rangle = \langle q^{d+1}\cdot \gr{g} \rangle$; and it is binding if the commitment described in Section~\ref{subsec:concretepoly} is binding.
\end{theorem}

\begin{proof}
The hiding commitment is a commitment to a degree $d+1$ polynomial. It therefore directly inherits the binding property from the non-hiding scheme.

To show hiding, we use the fact that the uniform distributions $[0,b]$ and $[a,a+b]$ have statistical distance $\frac{a}{b}$, \emph{i.e.}, the probability that any algorithm can distinguish the distributions from a single sample is less than $\frac{a}{b}$. Similarly $\gr{C}\gets ({f(q)+r\cdot q^{d+1}}) \cdot \gr{g}$ for $r\sample[0,B\cdot 2^{\lambda})$ has statistical distance at most $2^{-\lambda}$ from a uniform element generated by $\gr{g}$ if $B\geq |\langle \gr{g}\rangle|$. This means that two polynomial commitments can be distinguished by any algorithm with probability at most $2^{-\lambda+1}$.
\end{proof}


\paragraph{Zero-Knowledge Evaluation Protocol}

We now build a zero-knowledge evaluation protocol, which is an \eval protocol for a hiding polynomial commitment. The zero-knowledge protocol shows that the prover must know a degree $d$ polynomial $f(X)$ with bounded coefficients such that $f(z)\bmod p = y$ but does not leak any other information about $f$. Formally, we will show that the interactive $\pro{ZK-Eval}$ argument is honest verifier zero-knowledge according to Definition~\ref{def:hvzk} by constructing an efficient simulator $\mathcal{S}$ that can generate a distribution of transcripts that is indistinguishable from honestly generated transcripts.

The idea for the $\pro{ZK-Eval}$ protocol is a simple blinding of the polynomial borrowed from Zero-Knowledge Sumcheck~\cite{EPRINT:ChiForSpo17} and Bulletproofs~\cite{EC:BCCGP16,SP:BBBPWM18}. Let $f(X)$ be the committed polynomial, using the hiding commitment scheme. The prover wants to convince the verifier that $f(z)\bmod p=y$. To do this the prover commits to a degree $d$ polynomial $r(X)$ with random coefficients. The prover also reveals $y'\gets r(z)\bmod p$. The verifier then sends a random challenge $c$ and the prover and verifier can compute a commitment to $s(X)\gets r(X)+c\cdot f(X)$. The random polynomial $r(X)$ ensures that $s(X)$ is distributed statistically close to a random polynomial. The prover could just reveal $s(X)$ and the verifier can check that $s(z)\bmod p=y'+c \cdot y\bmod p$. Instead of sending $s(X)$ in the clear, the prover can additionally just send the commitment randomness to provide the verifier with a non-hiding commitment to $s(X)$. The prover and verifier can then use the standard $\eval$ protocol to efficiently evaluate $s$ at $z$.
 \noindent\begin{mdframed}[userdefinedwidth=\textwidth]
\begin{minipage}{\textwidth}
	\begin{flushleft}
	\pro{ZK-Eval}$(\params, \gr{C} \in \GG, z \in \ZZ_p, y \in \ZZ_p, d \in \NN; f(X) \in \ZZ(b)[X], r \in \ZZ):$\\
		%Statement: $\langle(\gr{C},z,y,d),(f(X) \in \ZZ(\frac{p-1}{2})[X],r)\rangle \in \mathcal{R}_\eval(\params)$\\
	%Input: $\params,\gr{C} \in \GG,z,y \in \ZZ_p, b\in \ZZ,d$, Witness: $f(X) \ZZ(b),\alpha \in \ZZ(2^\lambda)$\\
	\begin{enumerate}[nolistsep]
		    \item \prover samples a random degree $d$ $k(X) \sample \ZZ(p\cdot 2^{2 \lambda})[X]$ and $r_k \sample [0,B\cdot 2^\lambda)$ and computes $\gr{R} \gets (k(q) + r_k \cdot q^{d+1})+\gr{g}$ and $y_k \gets k(z) \bmod p$
		    \item \prover sends $\gr{R}$ and $y_k$ to $\verifier$
		    \item \verifier samples random $c\sample [0,2^\lambda)$ and sends it to $\prover$
		    \item \prover computes $s(X)\gets k(X) + c \cdot f(X)$, as well as $r_s \gets r_k + c\cdot r$.
		    \item \prover sends $r_s$ to \verifier
		    \item \prover and \verifier compute $\gr{C}_s\gets \gr{R} + c\cdot \gr{C} +(-q^{d+1}\cdot r_s)\cdot \gr{g}$ and $y_s\gets y_k+c \cdot y \bmod p$ \pccomment{$\gr{C}_s=s(q)\cdot \gr{g}$}
		    \item \prover and \verifier run $\pro{EvalB}(\crs,\gr{C}_s,z,y_s,d,\frac{p^2}{4}\cdot 2^{\lambda+1};s(X))$ \pccomment{$s(z)\bmod p=y_s$}		   		\end{enumerate}
	\end{flushleft}
\end{minipage}
\end{mdframed}

\benedikt{update/wrong}

\begin{theorem}
	Let $\CSZ,\EBL$ and $\CorrectnessBound$ be defined as in \cref{thm:darkisdarkss} . Let  $\log q \geq 4(\lambda + 1 + \CSZ[\mu+1]) + \EBL[\mu+1] + \mathsf{CB}_{p^2\cdot 2^{\lambda},\mu+1,\lambda} + 1$.
Under the adaptive root assumption for $\ggen$, the \textsf{JoinedEval} protocol has witness-extended-emulation (\Cref{def:wee}) for the relation $\mathcal{R_\textsf{JE}}$.

Let  $\eval$ have perfect completeness and witness extended emulation for $q> b\cdot \boldsymbol{\varsigma}_{p, d}$. Assuming that $\pro{commitH}$ is statistically hiding and both the order assumption and the strong RSA assumption hold for $\ggen$ the protocol $\pro{EvalZK}$ has perfect completeness, witness extended emulation and $\delta$-statistical honest-verifier zero-knowledge for $q>2^\lambda\cdot (p-1)(\frac{p^2-1}{2})^{\lceil \log_2(d+1)\rceil+1}<p^{2\log_2(d+1)+4}$ and $\delta \leq d \cdot 2^{-\lambda}$.
\end{theorem}

\begin{proof}
A simple application of Theorem~\ref{thm:algebraicIOPcompiler} and Lemma~\ref{lem:intrandomcombine} shows that the protocol maintains witness extended emulation. The extractor extracts $s(X)$ and $s'(X)$ from the $\eval$ protocol for challenges $c$ and $c'$. We can directly use Lemma~\ref{lem:intrandomcombine} to extract the witness $f(X)$ or a break of an assumption from these two transcripts. The bound on $q$ grows by a factor of less than $p^2$ (or $p^3$ under the $2$-Strong RSA assumption).   

To show zero-knowledge, we build the simulator $\mathcal{S}$ as follows. Start with a polynomial $s(X) \sample \mathbb{Z}(\frac{p^2-1}{4})[X]$ with uniform random coefficients, and a blinding factor $r_s \sample [0,B\cdot 2^{2\cdot\lambda+1})$. The simulator $\mathcal{S}$ then chooses a random challenge $c \sample [0,2^\lambda)$ and computes $\gr{R} = (s(q) + r_s \cdot q^{d+1})\gr{g} -c\cdot \gr{C}$. The simulator then performs the rest of the $\eval$ protocol honestly using $s(X)$ as the witness. 

The randomizer $r_s$ is distributed identically to the honest $r_s$. Given the hiding property of the commitment scheme, $\gr{R}$ is statistically indistinguishable from any other commitment. Finally the simulated and the honest $s(X)$ have statistical distance at most $2^{-\lambda}$ from a random polynomial. The coefficients of $c\cdot f(x)$ are in $\ZZ(\frac{p^2}{4})$. The coefficients of the blinding polynomial $s(X)$ are sampled from a range that is larger by a factor $2^{\lambda}$. So the distribution of coefficients of $s(X) = k(X) + c \cdot f(X)$ is at a statistical distance at most $2^{-\lambda}$ away from the uniform distribution over $\ZZ(\frac{p^2}{4})$. Since the distributions of simulated and real coefficients are both uniform but merely over different sets, the statistical distance between the simulated $s(X)$ and the real $s(X)$ is at most $d \cdot 2^{-\lambda}$. The evaluation with $\pro{EvalB}$ cannot leak more than $s(X)$ itself. The views of the simulated and real transcripts are, therefore, $\delta$-close with $\delta \leq d \cdot 2^{-\lambda}$. Consequently, the protocol has $\delta$-statistically honest verifier zero-knowledge.
\end{proof}
